kutugu

medium

# TWAP price can be manipulated

## Summary

The protocol uses the TWAP price when calculating the minimum swap slippage protection, but the TWAP price can be manipulated.

## Vulnerability Detail

Although the protocol supports _twap_length to obtain the average value, but if _twap_length is set too long, the historical price weight will be too high, and if the value is set too low, the slot0 weight will be too high to be manipulated.

## Impact

TWAP price can be manipulated causing the slippage protection is invalid and user swap can be sandwitched.

## Code Snippet

- https://github.com/sherlock-audit/2023-06-unstoppable/blob/94a68e49971bc6942c75da76720f7170d46c0150/unstoppable-dex-audit/contracts/spot-dex/Dca.vy#L213

## Tool used

Manual Review

## Recommendation

Use oracle to compare price difference
